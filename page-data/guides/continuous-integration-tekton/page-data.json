{"componentChunkName":"component---src-pages-guides-continuous-integration-tekton-index-mdx","path":"/guides/continuous-integration-tekton/","result":{"pageContext":{"isCreatedByStatefulCreatePages":true,"frontmatter":{"title":"Continuous Integration with Tekto","description":"This guide will explain how to use Tekton to manage your Continuous Integration process"},"relativePagePath":"/guides/continuous-integration-tekton/index.mdx","titleType":"page","MdxNode":{"id":"22c23da3-26b2-5881-96b0-5c483ba11043","children":[],"parent":"47d9953c-2d83-50f9-84eb-720fef0f62b0","internal":{"content":"---\ntitle: Continuous Integration with Tekto\ndescription: This guide will explain how to use Tekton to manage your Continuous Integration process\n---\n\n## Overview\n\nContinuous integration is a software development technique where software is built regularly by a team in an automated fashion.\n\nTekton is a new emerging CI tool that has been built to support Kubernetes and OpenShift from the ground up.\n\n- Read the this this [overview of Tekton](/guides/continuous-integration-tekton-crc#what-is-tekton)\n\n- For more information read up about it [here](https://developer.ibm.com/tutorials/knative-build-app-development-with-tekton/)\n\nThe IBM Cloud is standardizing on using Tekton in both IBM Cloud DevOps service and IBM Cloud Pak for Applications. OpenShift 4.2 will also natively support it.\n\nThis guide will focus on using Tekton when the Development tools have been installed along side [IBM Cloud Pak for Applications](https://www.ibm.com/cloud/cloud-pak-for-applications) to compliment your cloud native development toolset.\n\n### Tasks\n\n<InlineNotification>\n\n**Note:** This guide will help you setup the `Starter Kit Templates` with  **Tekton* and requires that you have installed Tekton with **IBM Cloud Pak for Applications* , **OpenShift 4.2** or have installed open source Tekton into the The IBM Kubernetes Cluster.\n</InlineNotification>\n\nThe following gives a description of what each task in the pipeline does. The *Optional* stages can be deleted or ignored if the tool supporting it is not installed. These stages represent a typical production pipeline flow for a Cloud Native application.\n\n- **Setup** clones the code into the pipeline\n- **Build** runs the build commands for the code\n- **Test**\tvalidates the unit tests for the code\n- **Publish pacts**\t(*optional*) publishes any pact contracts that have been defined\n- **Verify pact** (*optional*) verifies the pact contracts\n- **Sonar scan** (*optional*) runs a sonar code scan of the source code and publishes the results to SonarQube\n- **Build image** Builds the code into a Docker images and stores it in the IBM Cloud Image registry\n- **Deploy to DEV env**\tDeploys the Docker image tagged version to `dev` namespace using Helm Chart\n- **Health Check** Validates the Health Endpoint of the deployed application\n- **Package Helm Chart** (*optional*) Stores the tagged version of the Helm chart into Artifactory\n- **Trigger CD Pipeline** (*optional*) This is a GitOps stage that will update the build number in designated git repo and trigger ArgoCD for deployment to **test**\n\n### Install Tekton\n\n- Install [IBM Garage for Cloud Developer Tools](/admin/overview) on your managed OpenShift or IKS development cluster on the IBM Cloud\n- Install Tekton on OpenShift 3.11\n    - Install [IBM Cloud Paks for Applications](https://cloud.ibm.com/catalog/content/ibm-cp-applications) on the OpenShift Cluster from the IBM Cloud Catalog\n- Install Tekton on OpenShift 4 including CodeReady Containers (CRC)\n    - Install via operator hub Administrator perpective view, click Operator Hub search for \"OpenShift Pipelines\" and install operator\n- Install Tekton on IKS\n    - Install Tekton via Knative add-on, it includes tekton \n    - Install Tekton Dashboard https://github.com/tektoncd/dashboard#install-dashboard\n    - Install Tekton Webhook Extension https://github.com/tektoncd/experimental/tree/master/webhooks-extension#install-webhook-extension \n\n### Setup Tekton\n\n- Install tekton pipelines and tasks in the `tools` namespace follow the instructions in the repository [ibm-garage-tekton-tasks/](https://github.com/ibm-garage-cloud/ibm-garage-tekton-tasks/blob/master/README.md)\n\n### Configure namespace for development\n\n- Create a new namespace (ie `dev`) and copy all config and secrets\n  ```\n  igc namespace -n {new-namespace}\n  ```\n- Set your `new-namespace` the current namespace context\n  ```\n  oc project {new-namespace}\n  ```\n- Configure the sevice account `pipeline` if it doesn't exist, on OpenShift 4 the operator takes care of this you can skip.\n  ```\n  oc create serviceaccount pipeline\n  oc adm policy add-scc-to-user privileged -z pipeline\n  oc adm policy add-role-to-user edit -z pipeline\n  ```\n- Clone the tasks from the `tools` namespace into the `new-namespace`\n  ```\n  kubectl get tasks --export -o yaml -n tools  | sed s/\"namespace: tools/namespace: $(oc project -q)\"/ | kubectl apply -f -\n  ```\n- Clone the pipelines from the `tools` namespace into the `new-namespace`\n  ```\n  kubectl get pipelines --export -o yaml -n tools  | sed s/\"namespace: tools/namespace: $(oc project -q)\"/ | kubectl apply -f -\n  ```\n\n### Manually trigger a Pipeline\n\n- Install the Tekton CLI `tkn` https://github.com/tektoncd/cli\n\n- Create a new repository using java or nodejs templates applications github repositories\n  - https://github.com/ibm-garage-cloud/template-java-spring/generate\n  - https://github.com/ibm-garage-cloud/template-node-react/generate\n  - https://github.com/ibm-garage-cloud/template-node-typescript/generate\n  - https://github.com/ibm-garage-cloud/template-node-angular/generate\n  - https://github.com/ibm-garage-cloud/template-graphql-typescript/generate\n\n- Create a Pipeline resource for the git repository, replace with the correct github url for your repository\n  Use the `tkn` CLI to create `git` resource input the github repo url for `url` and branch for `revision`\n  ```\n  tkn resource create\n  ```\n  Here is the an example of the cli \n  ```\n  tkn resource create       \n  ? Enter a name for a pipeline resource : nodejs-typescript-git\n  ? Select a resource type to create : git\n  ? Enter a value for url :  https://github.com/{user or org}/{app}\n  ? Enter a value for revision :  master\n  New git resource \"nodejs-typescript-git\" has been created\n  ```\n- Create a Pipeline resource for the docker image registry, you can use the internal registry in OpenShift or use an external registry like IBM Container Registry (credentials need setup)\n  Use the `tkn` CLI to create `image` resource\n  ```\n  tkn resource create\n  ```\n  Select `image` for type.\n  \n  Enter the corresponding `url` for container registry, use the new-namespace} in the url \n  \n  For OCP 3 internal registry use `docker-registry.default.svc:5000/{new-namespace}/node-typescript:latest`\n  \n  For OCP 4 or CRC internal registry use `image-registry.openshift-image-registry.svc:5000/{new-namespace}/node-typescript:latest`\n  \n  For external registry like IBM Container registry based on region use `us.icr.io/{namespace}/node-typescript:latest` use an existing namespace in your IBM Cloud\n  ```\n  tkn resource create\n  ? Enter a name for a pipeline resource : nodejs-typescript-image\n  ? Select a resource type to create : image\n  ? Enter a value for url :  docker-registry.default.svc:5000/dev/node-typescript:latest\n  ? Enter a value for digest :  \n  New image resource \"nodejs-typescript-image\" has been created\n  ```\n- Select the pipeline, to show the available pipeline run\n  ```\n  tkn pipeline ls                                         \n  NAME              AGE              LAST RUN   STARTED   DURATION   STATUS\n  igc-java-gradle   33 minutes ago   ---        ---       ---        ---\n  igc-nodejs        33 minutes ago   ---        ---       ---        ---\n  ```\n  In this case use `igc-java-gradle` for java or `igc-nodejs` for nodejs.\n- Run the Pipeline using the `git` and `image` Pipeline resources.\n  Set the following environment variable for convienience:\n  ```\n  export PIPELINE=igc-nodejs\n  export GIT=nodejs-typescript-git\n  export IMAGE=nodejs-typescript-image\n  ```\n  Then run the `tkn pipeline start` with the input arguments using the service account `pipeline`\n  ```\n  tkn pipeline start \\\n  ${PIPELINE} \\\n  -r git-source=${GIT} \\\n  -r docker-image=${IMAGE} \\\n  -s pipeline\n  ```\n\n### Create a Git Webhook \n\n- Open the Tekton Dashboard from the main Tools Dashboard or the ICPA landing page.\n\n- Create a Webhook in the Tekton Dashboard\n    ![Webhook](/images/webhook.png)\n\n    - Click **Webhook** on the menu\n    - Click **Add Webhook** and enter the information for the webhook\n    - Name: **insert name**\n    - Repository UR: **template git repo url**\n    - Access Token: Create github access token with permission minimum write:repo_hook\n    - Namespace: **insert namespace**\n    - Pipeline: select **igc-java-gradle** or **igc-nodejs**\n    - Service Account: **pipeline**\n    - Docker Registry:\n        - For OCP 3 internal registry use `docker-registry.default.svc:5000/{new-namespace}`\n        - For OCP 4 or CRC internal registry use `image-registry.openshift-image-registry.svc:5000/{new-namespace}`\n        - For external registry like IBM Container registry based on region use `us.icr.io/{namespace}` use an existing namespace in your IBM Cloud. Make sure to configure docker credentials in the Tekton Dashboard using your IAM API Key and `iamapikey` for username in your namespace.\n\n- Check that Webhook is created on the Github repository (Settings-Webhooks)\n\n- Make a change to the git repo and push the change to remote git repository or click on **Pipelines**\nand manually kick of a pipeline build\n\n- Verify the **Pipelinerun** for the git change\n    ![Pipelinerun](/images/pipeline.png)\n\n## Running Application\n\n- Open the OpenShift Console and select the {new-namespace} project and click on **Workloads**\n    ![OpenShift](/images/openshiftconsole.png)\n\n- Get the hostname for the application from ingress\n    ```bash\n    kubectl get ingress --all-namespace\n    ```\n- You can use the the `igc` command to get the name of the deployed application\n    ```bash\n    igc ingress -n {new-namespace}\n    ```\n\n- Use the application URL to open it your browser for testing\n\nOnce you become familiar with deploying code into OpenShift or IKS using Tekton, read up about how you can manage code deployment with `Continuous Delivery` with `Artiactory` and `ArgoCD`\n\n<AnchorLinks small>\n  <AnchorLink to=\"../../guides/artifact-management\">Artifact Management with Artifactory</AnchorLink>\n  <AnchorLink to=\"../../guides/continuous-delivery\">Continuous Delivery with ArgoCD</AnchorLink>\n</AnchorLinks>\n\nYou can use the [Argo CD Template](/starterkits/argocd) to help define a deployment configuration for `test` and `staging` namespaces.","type":"Mdx","contentDigest":"960ff618fcfc20249beb573f787fcac8","counter":303,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"Continuous Integration with Tekto","description":"This guide will explain how to use Tekton to manage your Continuous Integration process"},"exports":{},"rawBody":"---\ntitle: Continuous Integration with Tekto\ndescription: This guide will explain how to use Tekton to manage your Continuous Integration process\n---\n\n## Overview\n\nContinuous integration is a software development technique where software is built regularly by a team in an automated fashion.\n\nTekton is a new emerging CI tool that has been built to support Kubernetes and OpenShift from the ground up.\n\n- Read the this this [overview of Tekton](/guides/continuous-integration-tekton-crc#what-is-tekton)\n\n- For more information read up about it [here](https://developer.ibm.com/tutorials/knative-build-app-development-with-tekton/)\n\nThe IBM Cloud is standardizing on using Tekton in both IBM Cloud DevOps service and IBM Cloud Pak for Applications. OpenShift 4.2 will also natively support it.\n\nThis guide will focus on using Tekton when the Development tools have been installed along side [IBM Cloud Pak for Applications](https://www.ibm.com/cloud/cloud-pak-for-applications) to compliment your cloud native development toolset.\n\n### Tasks\n\n<InlineNotification>\n\n**Note:** This guide will help you setup the `Starter Kit Templates` with  **Tekton* and requires that you have installed Tekton with **IBM Cloud Pak for Applications* , **OpenShift 4.2** or have installed open source Tekton into the The IBM Kubernetes Cluster.\n</InlineNotification>\n\nThe following gives a description of what each task in the pipeline does. The *Optional* stages can be deleted or ignored if the tool supporting it is not installed. These stages represent a typical production pipeline flow for a Cloud Native application.\n\n- **Setup** clones the code into the pipeline\n- **Build** runs the build commands for the code\n- **Test**\tvalidates the unit tests for the code\n- **Publish pacts**\t(*optional*) publishes any pact contracts that have been defined\n- **Verify pact** (*optional*) verifies the pact contracts\n- **Sonar scan** (*optional*) runs a sonar code scan of the source code and publishes the results to SonarQube\n- **Build image** Builds the code into a Docker images and stores it in the IBM Cloud Image registry\n- **Deploy to DEV env**\tDeploys the Docker image tagged version to `dev` namespace using Helm Chart\n- **Health Check** Validates the Health Endpoint of the deployed application\n- **Package Helm Chart** (*optional*) Stores the tagged version of the Helm chart into Artifactory\n- **Trigger CD Pipeline** (*optional*) This is a GitOps stage that will update the build number in designated git repo and trigger ArgoCD for deployment to **test**\n\n### Install Tekton\n\n- Install [IBM Garage for Cloud Developer Tools](/admin/overview) on your managed OpenShift or IKS development cluster on the IBM Cloud\n- Install Tekton on OpenShift 3.11\n    - Install [IBM Cloud Paks for Applications](https://cloud.ibm.com/catalog/content/ibm-cp-applications) on the OpenShift Cluster from the IBM Cloud Catalog\n- Install Tekton on OpenShift 4 including CodeReady Containers (CRC)\n    - Install via operator hub Administrator perpective view, click Operator Hub search for \"OpenShift Pipelines\" and install operator\n- Install Tekton on IKS\n    - Install Tekton via Knative add-on, it includes tekton \n    - Install Tekton Dashboard https://github.com/tektoncd/dashboard#install-dashboard\n    - Install Tekton Webhook Extension https://github.com/tektoncd/experimental/tree/master/webhooks-extension#install-webhook-extension \n\n### Setup Tekton\n\n- Install tekton pipelines and tasks in the `tools` namespace follow the instructions in the repository [ibm-garage-tekton-tasks/](https://github.com/ibm-garage-cloud/ibm-garage-tekton-tasks/blob/master/README.md)\n\n### Configure namespace for development\n\n- Create a new namespace (ie `dev`) and copy all config and secrets\n  ```\n  igc namespace -n {new-namespace}\n  ```\n- Set your `new-namespace` the current namespace context\n  ```\n  oc project {new-namespace}\n  ```\n- Configure the sevice account `pipeline` if it doesn't exist, on OpenShift 4 the operator takes care of this you can skip.\n  ```\n  oc create serviceaccount pipeline\n  oc adm policy add-scc-to-user privileged -z pipeline\n  oc adm policy add-role-to-user edit -z pipeline\n  ```\n- Clone the tasks from the `tools` namespace into the `new-namespace`\n  ```\n  kubectl get tasks --export -o yaml -n tools  | sed s/\"namespace: tools/namespace: $(oc project -q)\"/ | kubectl apply -f -\n  ```\n- Clone the pipelines from the `tools` namespace into the `new-namespace`\n  ```\n  kubectl get pipelines --export -o yaml -n tools  | sed s/\"namespace: tools/namespace: $(oc project -q)\"/ | kubectl apply -f -\n  ```\n\n### Manually trigger a Pipeline\n\n- Install the Tekton CLI `tkn` https://github.com/tektoncd/cli\n\n- Create a new repository using java or nodejs templates applications github repositories\n  - https://github.com/ibm-garage-cloud/template-java-spring/generate\n  - https://github.com/ibm-garage-cloud/template-node-react/generate\n  - https://github.com/ibm-garage-cloud/template-node-typescript/generate\n  - https://github.com/ibm-garage-cloud/template-node-angular/generate\n  - https://github.com/ibm-garage-cloud/template-graphql-typescript/generate\n\n- Create a Pipeline resource for the git repository, replace with the correct github url for your repository\n  Use the `tkn` CLI to create `git` resource input the github repo url for `url` and branch for `revision`\n  ```\n  tkn resource create\n  ```\n  Here is the an example of the cli \n  ```\n  tkn resource create       \n  ? Enter a name for a pipeline resource : nodejs-typescript-git\n  ? Select a resource type to create : git\n  ? Enter a value for url :  https://github.com/{user or org}/{app}\n  ? Enter a value for revision :  master\n  New git resource \"nodejs-typescript-git\" has been created\n  ```\n- Create a Pipeline resource for the docker image registry, you can use the internal registry in OpenShift or use an external registry like IBM Container Registry (credentials need setup)\n  Use the `tkn` CLI to create `image` resource\n  ```\n  tkn resource create\n  ```\n  Select `image` for type.\n  \n  Enter the corresponding `url` for container registry, use the new-namespace} in the url \n  \n  For OCP 3 internal registry use `docker-registry.default.svc:5000/{new-namespace}/node-typescript:latest`\n  \n  For OCP 4 or CRC internal registry use `image-registry.openshift-image-registry.svc:5000/{new-namespace}/node-typescript:latest`\n  \n  For external registry like IBM Container registry based on region use `us.icr.io/{namespace}/node-typescript:latest` use an existing namespace in your IBM Cloud\n  ```\n  tkn resource create\n  ? Enter a name for a pipeline resource : nodejs-typescript-image\n  ? Select a resource type to create : image\n  ? Enter a value for url :  docker-registry.default.svc:5000/dev/node-typescript:latest\n  ? Enter a value for digest :  \n  New image resource \"nodejs-typescript-image\" has been created\n  ```\n- Select the pipeline, to show the available pipeline run\n  ```\n  tkn pipeline ls                                         \n  NAME              AGE              LAST RUN   STARTED   DURATION   STATUS\n  igc-java-gradle   33 minutes ago   ---        ---       ---        ---\n  igc-nodejs        33 minutes ago   ---        ---       ---        ---\n  ```\n  In this case use `igc-java-gradle` for java or `igc-nodejs` for nodejs.\n- Run the Pipeline using the `git` and `image` Pipeline resources.\n  Set the following environment variable for convienience:\n  ```\n  export PIPELINE=igc-nodejs\n  export GIT=nodejs-typescript-git\n  export IMAGE=nodejs-typescript-image\n  ```\n  Then run the `tkn pipeline start` with the input arguments using the service account `pipeline`\n  ```\n  tkn pipeline start \\\n  ${PIPELINE} \\\n  -r git-source=${GIT} \\\n  -r docker-image=${IMAGE} \\\n  -s pipeline\n  ```\n\n### Create a Git Webhook \n\n- Open the Tekton Dashboard from the main Tools Dashboard or the ICPA landing page.\n\n- Create a Webhook in the Tekton Dashboard\n    ![Webhook](/images/webhook.png)\n\n    - Click **Webhook** on the menu\n    - Click **Add Webhook** and enter the information for the webhook\n    - Name: **insert name**\n    - Repository UR: **template git repo url**\n    - Access Token: Create github access token with permission minimum write:repo_hook\n    - Namespace: **insert namespace**\n    - Pipeline: select **igc-java-gradle** or **igc-nodejs**\n    - Service Account: **pipeline**\n    - Docker Registry:\n        - For OCP 3 internal registry use `docker-registry.default.svc:5000/{new-namespace}`\n        - For OCP 4 or CRC internal registry use `image-registry.openshift-image-registry.svc:5000/{new-namespace}`\n        - For external registry like IBM Container registry based on region use `us.icr.io/{namespace}` use an existing namespace in your IBM Cloud. Make sure to configure docker credentials in the Tekton Dashboard using your IAM API Key and `iamapikey` for username in your namespace.\n\n- Check that Webhook is created on the Github repository (Settings-Webhooks)\n\n- Make a change to the git repo and push the change to remote git repository or click on **Pipelines**\nand manually kick of a pipeline build\n\n- Verify the **Pipelinerun** for the git change\n    ![Pipelinerun](/images/pipeline.png)\n\n## Running Application\n\n- Open the OpenShift Console and select the {new-namespace} project and click on **Workloads**\n    ![OpenShift](/images/openshiftconsole.png)\n\n- Get the hostname for the application from ingress\n    ```bash\n    kubectl get ingress --all-namespace\n    ```\n- You can use the the `igc` command to get the name of the deployed application\n    ```bash\n    igc ingress -n {new-namespace}\n    ```\n\n- Use the application URL to open it your browser for testing\n\nOnce you become familiar with deploying code into OpenShift or IKS using Tekton, read up about how you can manage code deployment with `Continuous Delivery` with `Artiactory` and `ArgoCD`\n\n<AnchorLinks small>\n  <AnchorLink to=\"../../guides/artifact-management\">Artifact Management with Artifactory</AnchorLink>\n  <AnchorLink to=\"../../guides/continuous-delivery\">Continuous Delivery with ArgoCD</AnchorLink>\n</AnchorLinks>\n\nYou can use the [Argo CD Template](/starterkits/argocd) to help define a deployment configuration for `test` and `staging` namespaces.","fileAbsolutePath":"/Users/mjperrins/projects/cat/guide/src/pages/guides/continuous-integration-tekton/index.mdx"}}}}